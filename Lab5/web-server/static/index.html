<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電梯人數統計</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background-color: 
#f2f2f2;
        }
        tr:hover {
            background-color: 
#f5f5f5;
        }
        .loading {
            text-align: center;
            margin: 20px 0;
        }
        .error {
            color: red;
            text-align: center;
            margin: 20px 0;
        }
        .timestamp {
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
<h1>第五組-電梯人數統計</h1>
<div id="loading" class="loading">載入中...</div>
<div id="error" class="error" style="display: none;"></div>
<table border="1">
    <thead>
        <tr>
            <th>電梯編號</th>
            <th>電梯內人數</th>
            <th>電梯外人數</th>
            <th>更新時間</th>
        </tr>
    </thead>
    <tbody id="peopleData"></tbody>
</table>

<div id="lastUpdated" class="timestamp"></div>

<script>
(function() {
    // 顯示載入中訊息
    const loadingElement = document.getElementById('loading');
    const errorElement = document.getElementById('error');
    const peopleDataElement = document.getElementById('peopleData');
    const lastUpdatedElement = document.getElementById('lastUpdated');

    // 格式化時間的函數
    function formatDateTime(dateString) {
        const options = { 
            year: 'numeric', 
            month: 'numeric', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit', 
            second: '2-digit'
        };
        return new Date(dateString).toLocaleString('zh-TW', options);
    }

    // 取得資料的函數
    function fetchData() {
        loadingElement.style.display = 'block';
        errorElement.style.display = 'none';

        fetch('/api/people-counting')
            .then(response => {
                if (!response.ok) {
                    throw new Error(HTTP 錯誤：${response.status});
                }
                return response.json();
            })
            .then(data => {
                if (!data || data.length === 0) {
                    throw new Error('沒有資料');
                }

                loadingElement.style.display = 'none';

                // 取得最新的資料
                const latestEntry = data[data.length - 1];

                // 更新表格資料
                const row = 
                    <tr>
                        <td>${latestEntry.elevator_id}</td>
                        <td>${latestEntry.inside_count}</td>
                        <td>${latestEntry.outside_count}</td>
                        <td>${formatDateTime(latestEntry.time)}</td>
                    </tr>
                ;
                peopleDataElement.innerHTML = row;

                // 更新最後更新時間
                lastUpdatedElement.textContent = 最後更新：${new Date().toLocaleString('zh-TW')};
            })
            .catch(error => {
                loadingElement.style.display = 'none';
                errorElement.style.display = 'block';
                errorElement.textContent = 發生錯誤: ${error.message};
                console.error('發生錯誤:', error);
            });
    }

    // 初始載入資料
    fetchData();

    const refreshInterval = 1000; 
    setInterval(fetchData, refreshInterval);
})();
</script>
</body>
</html>
